{
    "collab_server" : "",
    "contents" : "---\ntitle: \"LC MLM modeling code\"\nauthor: \"Molly\"\ndate: \"April 5, 2018\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n```{r}\n### loading necessary libraries and uploading data\nlibrary(lme4)\nlibrary(exact2x2)\n#install.packages(\"robustlmm\")\n#library(robustlmm)\n#install.packages(\"sandwich\")\n#library(sandwich)\n\n#reading data \nind_full <- read.csv(\"~/Desktop/Loved Children/LC MLM/LC_merged.csv\")\n```\n\n```{r}\n# just looking at various cross-tabs \nmut <- table(ind_full$A437G, ind_full$K540E, ind_full$year)\nmut\n\nmut <- table(ind_full$A437G, ind_full$K540E, ind_full$A581G, ind_full$year)\nftable(mut)\n\n\nmixed_tab <- table(ind_full$mixed, ind_full$year)\n28/(28+194)\n115/(115+423)\nchisq.test(mixed_tab)\nprop.test(mixed_tab)\n## number of mixed infections increased from ~ 13% to ~21% \n\ndhps_tab <- table(ind_full$dhps_mut, ind_full$year)\ndhps_tab\nsummary(dhps_tab)\nprop.test(dhps_tab)\n\nK540E_tab <- table(ind_full$K540E, ind_full$year)\nK540E_tab\nchisq.test(K540E_tab)\nprop.test(K540E_tab)\n\ncrt_tab <- table(ind_full$CRT, ind_full$year)\ncrt_tab\nchisq.test(crt_tab)\n\n## looking at non-mixed infections \nmonoclonal <- subset(ind_full, ind_full$mixed == 0)\n\nmono_year <- table(monoclonal$year)\nmono_year\n\nmono_mut <- table(monoclonal$A437G, monoclonal$K540E, monoclonal$year)\nftable(mono_mut)\nsummary(mono_mut)\n?fisher.test\nprop.test(mono_mut)\n\nmono_dhps <- table(monoclonal$dhps_mut, monoclonal$year)\nmono_dhps\nsummary(mono_dhps)\nchisq.test(mono_dhps)\nprop.test(mono_dhps)\n\nmono_a437g <- table(monoclonal$A437G, monoclonal$year)\nmono_a437g\nchisq.test(mono_a437g)\nsummary(mono_a437g)\n\nmono_k540e <- table(monoclonal$K540E, monoclonal$year)\nmono_k540e\nsummary(mono_k540e)\n10/(10+104)\n68/(142+68)\nchisq.test(mono_k540e)\n\nmono_crt <- table(monoclonal$CRT, monoclonal$year)\nmono_crt\n(57/(24+38))\n222/(222+176)\nchisq.test(mono_crt)\nsummary(mono_crt)\n\n```\n\n\n```{r}\n#########################\n#### DHPS mutations ####\n########################\n\n## trying some univariate logistic models \n## any mutation outcome \n## could probably write a function to do this more efficiently...\n\nuni1 <- glmer(dhps_mut  ~ prevalence + (1|year/cluster), data = ind_full, family=binomial(link =logit))\nsummary(uni1)\n\nuni1 <- glmer(dhps_mut  ~ prevalence + (1|province), data = ind_full, family =binomial(link=\"logit\"))\nsummary(uni1)\n\nuni2 <- glmer(dhps_mut  ~ FansPercent+ (1|year/province), data = ind_full, family=binomial(link = logit))\nsummary(uni2)\n\nuni3 <- glmer(dhps_mut  ~ mixed + (1|year) + (1|cluster) , data = ind_full, family=binomial(link = logit))\nsummary(uni3)\n\nuni4 <- glmer(dhps_mut  ~ pctedu0+ (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni4)\n\nuni5 <- glmer(dhps_mut  ~ urban1rural0 + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni5)\n\nuni6 <- glmer(dhps_mut  ~ wealthindex + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni6)\n\nuni7 <- glmer(dhps_mut  ~ wealth_mean + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni7)\n```\n\n```{r}\n### 540E outcome \n\nuni_k1 <- glmer(K540E  ~ prevalence + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni_k1)\n\nuni_k2 <- glmer(K540E  ~ FansPercent + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni_k2)\n\nuni_k3 <- glmer(K540E  ~ wealthindex + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni_k3)\n\nuni_k4 <- glmer(K540E  ~ wealth_mean + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni_k4)\n\nuni_k5 <- glmer(K540E  ~ mixed + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni_k5)\n\nuni_k6 <- glmer(K540E  ~ pctedu0 + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni_k6)\n\nuni_k7 <- glmer(K540E  ~ urban1rural0 + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(uni_k7)\n```\n\n```{r}\n####################\n### CRT data ######\n###################\n## chloroquine data is super spotty - not really reliable in this analysis \n\n### the CRT outcome is only for the K76T mutation since ~95% of the haplotypes have this mutation\ncrt1 <- glmer(CRT  ~ prevalence + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(crt1)\n\ncrt2 <- glmer(CRT  ~ wealthindex + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(crt2)\n## tried as a factor and model didn't converge? \n\ncrt3 <- glmer(CRT  ~ wealth_median + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(crt3)\n\ncrt4 <- glmer(CRT  ~ mixed + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(crt4)\n\ncrt5 <- glmer(CRT  ~ pctedu0 + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(crt5)\n\ncrt6 <- glmer(CRT  ~ urban1rural0 + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(crt6)\n\ncrt6 <- glmer(CRT  ~ urban1rural0 + (1|year/cluster), data = ind_full, family=binomial(link = logit))\nsummary(crt6)\n```\n\n```{r}\n#### trying poisson regression with robust variance to see if we can get risks since log binomial models did not converge \npoisson_1 <- glmer(dhps_mut  ~ PrevPct10 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_1)\n\npoisson_1 <- glmer(dhps_mut  ~ PrevPct10 + (1|year) + (1|province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_1)\n\npoisson_2 <- glmer(dhps_mut  ~ Fansidar10 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_2)\n\npoisson_3 <- glmer(dhps_mut  ~ wealthindex + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_3)\n\npoisson_4 <- glmer(dhps_mut  ~ wealth_mean + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_4)\n\npoisson_5 <- glmer(dhps_mut  ~ mixed + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_5)\n\n#poisson_5 <- glm(dhps_mut  ~ mixed, data = ind_full, family=poisson(link = \"log\"))\n#summary(poisson_5)\n\n### sandwich estimator ### \n# poisson_se <- glm(dhps_mut  ~ mixed, data = ind_full, family=poisson)\n# cov.m1 <- vcovHC(poisson_se, type=\"HC0\")\n# std.err <- sqrt(diag(cov.m1))\n# r.est <- cbind(Estimate = coef(poisson_se), \n#                \"Robust SE\" = std.err,\n#                \"Pr(>|z|)\" = 2 * pnorm(abs(coef(poisson_se)/std.err), lower.tail=FALSE),\n#                LL = coef(poisson_se) - 1.96 * std.err,\n#                UL = coef(poisson_se) + 1.96 * std.err\n#                )\n# r.est\n# summary(poisson_5)\n\n\npoisson_6 <- glmer(dhps_mut  ~ pctedu0 + (1|year), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_6)\n\npoisson_7 <- glmer(dhps_mut  ~ urban1rural0 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_7)\n\npoisson_8 <- glmer(dhps_mut  ~ total + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_8) # total variable is the total number of people within that DHS cluster -- proxy for population density\n\npoisson_9 <- glmer(dhps_mut  ~ weighted_total + (1|year) + (1|province), data = ind_full, family=poisson(link = \"log\"))\nsummary(poisson_9) # using sampling weights \n\n\n```\n\n```{r}\n####### CRT ########\n#### trying poisson regression with robust variance to see if we can get risks since log binomial models did not converge \n\nCRT_1 <- glmer(CRT  ~ PrevPct10 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(CRT_1)\n\nCRT_2 <- glmer(CRT  ~ Chlor10 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(CRT_2)\n\nCRT_3 <- glmer(CRT  ~ wealthindex + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(CRT_3)\n\nCRT_4 <- glmer(CRT  ~ wealth_mean + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(CRT_4)\n\nCRT_5 <- glmer(CRT  ~ mixed + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(CRT_5)\n\nCRT_6 <- glmer(CRT  ~ pctedu0 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(CRT_6)\n\nCRT_7 <- glmer(CRT  ~ urban1rural0 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(CRT_7)\n\nCRT_8 <- glmer(CRT  ~ total + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(CRT_8)\n\n```\n\n```{r}\n#################\n### K540E ########\n################\nK540E_1 <- glmer(K540E ~ PrevPct10 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(K540E_1)\n\nK540E_prev10 <- glmer(K540E  ~ PrevPct10 + (1|year/province), data = ind_full, family=K540E(link = \"log\"))\nsummary(K540E_prev10)\n\nK540E_2 <- glmer(K540E  ~ Fansidar10 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(K540E_2)\n\n#K540E_3 <- glmer(K540E ~ as.factor(wealthindex) + (1|year/province), data = ind_full, family=K540E(link = \"log\"))\n#summary(K540E_3)\n\nK540E_3 <- glmer(K540E ~ wealthindex + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(K540E_3)\n\nK540E_4 <- glmer(K540E  ~ wealth_mean + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(K540E_4)\n\nK540E_5 <- glmer(K540E  ~ mixed + (1|year), data = ind_full, family=poisson(link = \"log\"))\nsummary(K540E_5)\n\nK540E_6 <- glmer(K540E  ~ pctedu0 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(K540E_6)\n\nK540E_7 <- glmer(K540E  ~ urban1rural0 + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(K540E_7)\n\nK540E_8 <- glmer(K540E  ~ Fansidar10 + (1|year/province), data = ind_full, family=K540E(link = \"log\"))\nsummary(K540E_8)\n\nK540E_9 <- glmer(K540E  ~ weighted_total + (1|year/province), data = ind_full, family=poisson(link = \"log\"))\nsummary(K540E_9)\n\n```\n\n\n\n",
    "created" : 1526910371537.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "436893156",
    "id" : "EBEDB024",
    "lastKnownWriteTime" : 1531365012,
    "last_content_update" : 1531365012,
    "path" : "~/Desktop/Loved Children/LC MLM/LC MLM modeling code.Rmd",
    "project_path" : "LC MLM modeling code.Rmd",
    "properties" : {
        "last_setup_crc32" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}